{% extends 'base.html.twig' %}

{% block title %}Hello CandidateController!
{% endblock %}

{% block content %}
	<div class="card">
		<div class="table-responsive">
			<h3 class="card-header">List des  Candidat</h3>
			{% for type in type_list %}


				<h4 class="card-header text-center">{{type.intitule}}</h4>


				<table class="table table-striped" id="client_table">


					<thead>
						<tr>

							<th style="width: 10rem;">CIN</th>

							<th style="width: 10rem;">Nom</th>

							<th style="width: 10rem;">Prenom</th>

							<th style="width: 10rem;">Nationalite</th>

							<th style="width: 10rem;">Fonctionnaire</th>


							<th style="width: 20rem;">Specialite</th>


							<th style="width: 20rem;">Option</th>


						</tr>
					</thead>
					<tbody>
						{% for Candidat in candidat_list %}

							{% if (Candidat.type.intitule == type.intitule) %}

								<form action="" id="Candidat_form_{{ Candidat.id }}" class="mt-3">


									<tr>

										<td>{{ Candidat.cin }}</td>
										<td>{{ Candidat.nom }}</td>
										<td>{{ Candidat.prenom }}</td>
										<td>{{ Candidat.nationnalite }}</td>
										<td>{{ Candidat.Fonctionnaire ? "oui":"Non" }}</td>

										<td>

											<select class="form-select" id="Specialite_{{ Candidat.id }}">


												{% for Post in post_list %}
													{% if (Post.Specialite.type.intitule == type.intitule  and Post.nbrreste > 0)  %}

														<option value="{{ Post.Specialite.id }}" id="categorie_{{ Candidat.id }}_{{ Post.Specialite.id }}">{{ Post.Specialite.intitule }}</option>


													{% endif %}

												{% endfor %}
											</select>
										</td>
										<td>
											{% if Candidat.Fonctionnaire == true or Candidat.nationnalite !='MAROCAINE'   %}

												<select class="form-select" id="categorie_{{ Candidat.id }}" disabled>


													<option value="{{ Candidat.categorie.id }}" id="categorie_{{ Candidat.id }}_{{ Candidat.categorie.id }}">{{Candidat.categorie.intitule}}</option>

												</select>

											{% else %}
												<select class="form-select" id="categorie_{{ Candidat.id }}">
													{% for categorie in categorie_list %}
														{% if categorie.intitule != 'benevole etranger' %}


															<option value="{{ categorie.id }}" id="categorie_{{ Candidat.id }}_{{ categorie.id }}">{{categorie.intitule}}</option>
														{% endif %}

													{% endfor %}
												</select>

											{% endif %}


										</td>

										<td>
											<a class="btn btn-primary btn-sm edit_client_btn" data-id="{{ Candidat.id }}" style="width: 2.6rem;" href="javascript:void(0);">

												<i class="bx bx-check me-1"></i>
											</a>
											<button type="submit" style="display: none;" class="btn btn-primary">Save</button>


										</td>

									</tr>

								</form>

							{% endif %}

						{% endfor %}
					</tbody>


				</table>
			{% endfor %}


		</div>
	</div>
	{% block javascript %}
		{#}		<script>
																							console.log("fields");
																				
																				// set active page
																				$('#candidate').toggleClass('active');
																						</script>
																				
																				
																						<script>
																				
																				
																							/* $("#Specialite_".concat(id))[0].value,
																				$("#categorie_".concat(id))[0].value
																				];
																				 */
																				
																				$(document).on('click', '.edit_client_btn', function () {
																				
																				let id = $(this).data('id');
																				let url = "{{ path('update_candidate', {id: 'p_id',id1:'p_id1',id2:'p_id2'}) }}";
																				
																				$.ajax({
																				url: url.replace('p_id', id).replace('p_id1', $("#Specialite_".concat(id))[0].value).replace('p_id2', $("#categorie_".concat(id))[0].value);
																				
																				method: 'POST',
																				data: $(this).serialize();
																				}).then((response) => {
																				if (response == "updated") {
																				Swal.fire({
																				icon: 'success',
																				title: 'Updated',
																				text: 'The candidate has been updated.',
																				confirmButtonColor: '#3085d6',
																				confirmButtonText: 'OK',
																				timer: 1000
																				}).then(function () {
																				setTimeout(function () {
																				location.reload()
																				}, 500);
																				});
																				}
																				
																				})
																				
																				})
																				
																						</script>#}


		<script>
			$(document).on('click', '.edit_client_btn', function () {
let id = $(this).data('id');
let url = "{{ path('update_candidate', {id: 'p_id',id1:'p_id1',id2:'p_id2'}) }}";
let id1 = $("#Specialite_".concat(id))[0].value;
let id2 = $("#categorie_".concat(id))[0].value;


event.preventDefault();
// Data validation
let fields = [id1, id2];

let isValid = true;

fields.forEach(field => {
if (field === "") { // field.addClass("error");
isValid = false;
}
});

if (isValid) {
$.ajax({
url: url.replace('p_id', id).replace('p_id1', id1).replace('p_id2', id2),


method: 'POST',
data: $(this).serialize()
}).then((response) => {
if (response == "updated") {
Swal.fire({
icon: 'success',
title: 'Updated',
text: 'The client has been updated.',
confirmButtonColor: '#3085d6',
confirmButtonText: 'OK',
timer: 1000
}).then(function () {
setTimeout(function () {
location.reload()
}, 500);
});
}
})
}
})
		</script>

	{% endblock %}

{% endblock %}
